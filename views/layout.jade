doctype html
html(lang='en', ng-app='myApp')
  head
    title Mame High Scores
    meta(name="viewport" content="width=device-width, initial-scale=1")

    //update the verson on this if changeing the favicon
    link(rel="shortcut icon" href="favicon.ico?v=2")


    //Latest compiled and minified CSS
    //link(rel='stylesheet' href='//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css')
    //Optional theme
    link(rel='stylesheet' href='//netdna.bootstrapcdn.com/bootswatch/3.1.1/yeti/bootstrap.min.css')

    script(src='//code.jquery.com/jquery-2.1.0.min.js')

    link(rel='stylesheet' href='/css/app.css')
    link(rel='stylesheet' href='/css/angular-busy.css')

    script(src='js/dependencies/sails.io.js')
    script(src='js/dependencies/angular.js')
    script(src='js/dependencies/angular-route.js')
    script(src='js/dependencies/angular-animate.js')
    script(src='js/dependencies/angular-sails.js')
    script(src='js/dependencies/moment.js')
    script(src='js/dependencies/angular-moment.js')
    script(src='js/dependencies/ui-bootstrap.js')
    script(src='js/dependencies/ui-bootstrap-tpls.js')
    script(src='js/dependencies/angular-busy.js')
    script(src='js/app.js')
    script(src='js/services.js')
    script(src='js/controllers.js')
    script(src='js/filters.js')
    script(src='js/directives.js')
    script(src='//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js')


  body

    .navbar.navbar-default.navbar-fixed-top(role='navigation' id='nav_bar')
      .container
        .navbar-header
          button.navbar-toggle(type='button', data-toggle='collapse', data-target='.navbar-collapse')
            span.sr-only Toggle navigation
            span.icon-bar
            span.icon-bar
            span.icon-bar
          a.navbar-brand(href='/') Mame High Scores
            small(style='font-size: 0.5em') (v#{sails.config.globals.version})
        .navbar-collapse.collapse
          ul.nav.navbar-nav
            li
              a(href='#/games') Games
            li
              a(href='#/users') Users
            li
              a(href='#/game-upload') Upload File
            li
              a(href='#/settings') Settings
            li
              a(href='#/admin') Admin

          form.navbar-form.navbar-right(role='search')
            .form-group(ng-controller="SearchCtrl")
              input.form-control.typeahead(type='text', placeholder='Search' ng-model="selected" typeahead="game.full_name + ' [' + game.name + ']' for game in games | filter:$viewValue | limitTo:8" typeahead-on-select="onSelected($item, $model, $label)")

    .container
      .jumbotron(style='margin-top: 50px')
        block body

    //TODO: move this into its own file
    script.
      //this closes the menu when in drop down mode
      //needed because we are a single pag app
      $(document).on('click','.navbar-collapse.in',function(e) {
          if( $(e.target).is('a') ) {
              $(this).collapse('hide');
          }
      });

      io.socket.on("score", function (message) {
        console.log('**got score message**');
        console.log(message);
        if (message.verb === "created") {
          var notificationText = message.data.name + " just set a new high score of " + message.data.score + " on " + message.data.game.full_name;
          var n = new Notification(notificationText,
            { body: "Click here to view the new scores", icon: "/images/notification-icon.png"});
          n.onclick = function() {
            n.close();
            location.href = "/#games/" + message.data.game.id;
          }

          n.onshow = function () {
            setTimeout(function() { n.close() }, 10000);
          }
        }
      });